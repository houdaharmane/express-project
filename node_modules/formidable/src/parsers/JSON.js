/* eslint-disable no-underscore-dangle */

<<<<<<< HEAD
import { Transform } from 'node:stream';
=======
'use strict';

const { Transform } = require('stream');
>>>>>>> 5feea03a860e1851f4a7432dfd45499e26af9716

class JSONParser extends Transform {
  constructor(options = {}) {
    super({ readableObjectMode: true });
    this.chunks = [];
    this.globalOptions = { ...options };
  }

  _transform(chunk, encoding, callback) {
    this.chunks.push(String(chunk)); // todo consider using a string decoder
    callback();
  }

  _flush(callback) {
    try {
      const fields = JSON.parse(this.chunks.join(''));
<<<<<<< HEAD
      this.push(fields);
=======
      Object.keys(fields).forEach((key) => {
        const value = fields[key];
        this.push({ key, value });
      });
>>>>>>> 5feea03a860e1851f4a7432dfd45499e26af9716
    } catch (e) {
      callback(e);
      return;
    }
    this.chunks = null;
    callback();
  }
}

<<<<<<< HEAD
export default JSONParser;
=======
module.exports = JSONParser;
>>>>>>> 5feea03a860e1851f4a7432dfd45499e26af9716
